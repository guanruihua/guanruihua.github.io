"use strict";(self.webpackChunkguanruihua_github_io=self.webpackChunkguanruihua_github_io||[]).push([[4601],{2912:(e,i,t)=>{t.r(i),t.d(i,{default:()=>o});var r=t(5296),l=t(6045);const a=t.p+".web/img/tile.png",s=e=>{if(!e)return;let i={tileSize:200,colors:{0:16777215,2:16777215,4:16772846,8:16768477,16:16764108,32:16759739,64:16755370,128:16751001,256:16746632,512:16742263,1024:16737894,2048:16733525,4096:16729156,8192:16724787,16384:16720418,32768:16716049,65536:16711680},tweenSpeed:50};var t=new e.Class({Extends:e.Scene,initialize:function(){e.Scene.call(this,{key:"PlayGame"})},preload:function(){this.load.image("tile",a)},create:function(){this.fieldArray=[],this.fieldGroup=this.add.group();for(var e=0;e<4;e++){this.fieldArray[e]=[];for(var t=0;t<4;t++){var r=this.add.sprite(t*i.tileSize+i.tileSize/2,e*i.tileSize+i.tileSize/2,"tile");r.alpha=0,r.visible=0,this.fieldGroup.add(r);var l=this.add.text(t*i.tileSize+i.tileSize/2,e*i.tileSize+i.tileSize/2,"2",{font:"bold 64px Arial",color:"black",align:"center"});l.setOrigin(.5),l.alpha=0,l.visible=0,this.fieldGroup.add(l),this.fieldArray[e][t]={tileValue:0,tileSprite:r,tileText:l,canUpgrade:!0}}}console.log(this),this.input.keyboard.on("keydown",this.handleKey,this),this.canMove=!1,this.addTwo(),this.addTwo()},addTwo:function(){for(var t=[],r=0;r<4;r++)for(var l=0;l<4;l++)0==this.fieldArray[r][l].tileValue&&t.push({row:r,col:l});var a=e.Utils.Array.GetRandomElement(t);this.fieldArray[a.row][a.col].tileValue=2,this.fieldArray[a.row][a.col].tileSprite.visible=!0,this.fieldArray[a.row][a.col].tileText.setText("2"),this.fieldArray[a.row][a.col].tileText.visible=!0,this.tweens.add({targets:[this.fieldArray[a.row][a.col].tileSprite,this.fieldArray[a.row][a.col].tileText],alpha:1,duration:i.tweenSpeed,onComplete:function(e){e.parent.scene.canMove=!0}})},handleKey:function(e){if(this.canMove){var i=this.fieldGroup.getChildren();switch(e.code){case"ArrowLeft":case"KeyA":for(var t=0;t<i.length;t++)i[t].depth=i[t].x;this.handleMove(0,-1);break;case"ArrowRight":case"KeyD":for(t=0;t<i.length;t++)i[t].depth=l.config.width-i[t].x;this.handleMove(0,1);break;case"ArrowUp":case"KeyW":for(t=0;t<i.length;t++)i[t].depth=i[t].y;this.handleMove(-1,0);break;case"ArrowDown":case"KeyS":for(t=0;t<i.length;t++)i[t].depth=l.config.height-i[t].y;this.handleMove(1,0)}}},handleMove:function(e,i){this.canMove=!1;var t=!1;this.movingTiles=0;for(var r=0;r<4;r++)for(var l=0;l<4;l++){var a=1==i?3-l:l,s=1==e?3-r:r,n=this.fieldArray[s][a].tileValue;if(0!=n){for(var o=i,d=e;this.isInsideBoard(s+d,a+o)&&0==this.fieldArray[s+d][a+o].tileValue;)o+=i,d+=e;this.isInsideBoard(s+d,a+o)&&this.fieldArray[s+d][a+o].tileValue==n&&this.fieldArray[s+d][a+o].canUpgrade&&this.fieldArray[s][a].canUpgrade?(this.fieldArray[s+d][a+o].tileValue=2*n,this.fieldArray[s+d][a+o].canUpgrade=!1,this.fieldArray[s][a].tileValue=0,this.moveTile(this.fieldArray[s][a],s+d,a+o,Math.abs(d+o),!0),t=!0):(d-=e,0==(o-=i)&&0==d||(this.fieldArray[s+d][a+o].tileValue=n,this.fieldArray[s][a].tileValue=0,this.moveTile(this.fieldArray[s][a],s+d,a+o,Math.abs(d+o),!1),t=!0))}}t||(this.canMove=!0)},moveTile:function(e,t,r,l,a){this.movingTiles++,this.tweens.add({targets:[e.tileSprite,e.tileText],x:r*i.tileSize+i.tileSize/2,y:t*i.tileSize+i.tileSize/2,duration:i.tweenSpeed*l,onComplete:function(i){i.parent.scene.movingTiles--,a&&i.parent.scene.transformTile(e,t,r),0==i.parent.scene.movingTiles&&(i.parent.scene.resetTiles(),i.parent.scene.addTwo())}})},transformTile:function(e,t,r){this.movingTiles++,e.tileText.setText(this.fieldArray[t][r].tileValue.toString()),e.tileSprite.setTint(i.colors[this.fieldArray[t][r].tileValue]),this.tweens.add({targets:[e.tileSprite],scaleX:1.1,scaleY:1.1,duration:i.tweenSpeed,yoyo:!0,repeat:1,onComplete:function(e){e.parent.scene.movingTiles--,0==e.parent.scene.movingTiles&&(e.parent.scene.resetTiles(),e.parent.scene.addTwo())}})},resetTiles:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.fieldArray[e][t].canUpgrade=!0,this.fieldArray[e][t].tileSprite.x=t*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileSprite.y=e*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileText.x=t*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileText.y=e*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileValue>0?(this.fieldArray[e][t].tileSprite.alpha=1,this.fieldArray[e][t].tileSprite.visible=!0,this.fieldArray[e][t].tileText.alpha=1,this.fieldArray[e][t].tileText.visible=!0,this.fieldArray[e][t].tileText.setText(this.fieldArray[e][t].tileValue.toString())):(this.fieldArray[e][t].tileValue=0,this.fieldArray[e][t].tileSprite.alpha=0,this.fieldArray[e][t].tileSprite.visible=!1,this.fieldArray[e][t].tileText.alpha=0,this.fieldArray[e][t].tileText.visible=!1),this.fieldArray[e][t].tileSprite.setTint(i.colors[this.fieldArray[e][t].tileValue])},isInsideBoard:function(e,i){return e>=0&&i>=0&&e<4&&i<4}}),r={type:e.WEBGL,width:4*i.tileSize,height:4*i.tileSize,backgroundColor:4473924,scene:[t]};let l=new e.Game(r);function s(){var e=document.querySelector("canvas");if(e){var i=window.innerWidth,t=window.innerHeight,r=i/t,a=l.config.width/l.config.height;r<a?(e.style.width=i+"px",e.style.height=i/a+"px"):(e.style.width=t*a+"px",e.style.height=t+"px")}}window.focus(),s(),window.addEventListener("resize",s,!1)},n=()=>{const[e,i]=r.useState(null),[t,a]=(0,l.xI)({});return r.useEffect(()=>{const e="/js/phaser.min.js",t=document.createElement("script");return t.src=e,t.onload=()=>{console.log(e,"已加载");const t=window.Phaser;i(t),t&&s(t)},document.body.appendChild(t),()=>{document.body.removeChild(t)}},[]),{state:t,setState:a}};function o(){const{state:e,setState:i}=n();return r.createElement("div",{className:"game-2048"})}}}]);