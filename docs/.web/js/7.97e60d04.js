"use strict";(self.webpackChunkguanruihua_github_io=self.webpackChunkguanruihua_github_io||[]).push([[7],{1814:(e,t,r)=>{function a(e){return null==e||e!=e}function n(e){return void 0===e}r.d(t,{B9:()=>s,Et:()=>c,Im:()=>a,Kg:()=>i,Lm:()=>m,b0:()=>n,cy:()=>u,vH:()=>d});Number.isNaN;function o(e){try{if("object"==typeof(t=e)&&!a(t)&&/Iterator\]$/.test(t.toString()))return"Iterator";const r=Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1];return"Number"===r&&isNaN(e)?"NaN":r}catch(e){return"Undefined"}var t}function l(e){return null!==e&&"object"==typeof e&&"Object"===o(e)}function s(e){return!a(e)&&(l(e)&&0!==Reflect.ownKeys(e).length)}function i(e){return"string"==typeof e}const c=e=>"number"==typeof e&&"Number"===o(e);function u(e){return Array.isArray(e)}function d(e){return!a(e)&&(u(e)&&e.length>0)}new Map([["Image",["png","jpeg","jpg","png","bmp"]],["Video",["mp4","webm","ogg"]],["PDF",["pdf"]],["Word",["doc","docx"]],["Excel",[".xlsx",".xls",".csv"]]]);const p="undefined"!=typeof window,m=e=>"boolean"==typeof e;p&&window?.navigator?.userAgent&&/iP(ad|hone|od)/.test(window.navigator.userAgent)},2007:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$});var a=r(4777),n=r(5296),o=r(5186);var l=r(1814);const s=e=>{const t=[],r=[];return(0,l.cy)(e)&&e.forEach(({name:e,value:a})=>{t.push(e),r.push(a)}),{xData:t,yData:r}};var i=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,y=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&y(e,r,t[r]);if(d)for(var r of d(t))m.call(t,r)&&y(e,r,t[r]);return e},f=(e,t)=>c(e,u(t));const g={dataZoom:[{show:!0,type:"slider",startValue:0,yAxisIndex:[0]}],grid:{top:"10%",left:"8%",right:"5%",bottom:"17%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}}},v=e=>{const{data:t=[]}=e,{xData:r=[],yData:a=[]}=s(t);return f(h({},g),{xAxis:{type:"value",boundaryGap:!1,minInterval:1,axisLabel:{clickable:!1}},yAxis:{type:"category",boundaryGap:!0,data:r,axisLabel:{show:!0,clickable:!1,lineStyle:{color:"#f2f2f2"},formatter:function(e){let t=e;return t.length>20&&(t=t.substr(0,20)+"..."),t}}},series:[{data:a,type:"bar",label:{show:!0,position:"right",color:"#862633"}}]})},b=v,w={zh_CN:{total:"总数",drawChart:"图表已绘制成功完成",startFindData:"开始获取系统数据...",endFindData:"获取系统数据完成, 并开始分析..."},en_US:{total:"Total",drawChart:"The chart has been successfully drawn",startFindData:"Start retrieving system data ..",endFindData:"Get system data completed and start analysis. .."}},x=(e,t)=>{var r,a;return(null==(r=null==w?void 0:w[e])?void 0:r[t])||(null==(a=w.en_US)?void 0:a[t])||t},_={bottom:"2%",left:"2%",type:"scroll",textStyle:{align:"left",verticalAlign:"middle",rich:{name:{color:"rgba(0,0,0,0.5)",fontSize:12},value:{color:"rgba(0,0,0,0.5)",fontSize:12},rate:{color:"rgba(0,0,0,0.9)",fontSize:12}}}},P=(e,t={})=>{const{title:r}=t;let a={};if("draw_bar_chart"===e&&(a=v(t)),"draw_x_bar_chart"===e&&(a=b(t)),"draw_y_bar_chart"===e&&(a=(e=>{const{data:t=[]}=e,{xData:r=[],yData:a=[]}=s(t);return f(h({},g),{xAxis:{type:"category",data:r},yAxis:{type:"value"},series:[{data:a,type:"bar"}]})})(t)),"draw_pie_chart"===e&&(a=(e=>{const{title:t,lang:r="en_US",data:a=[]}=e,n={};if((0,l.cy)(a)&&a.length>10){const e=a.slice().sort((e,t)=>t-e).slice(0,10).map(e=>e.name);a.forEach(({name:t})=>{n[t]=e.includes(t)})}return{tooltip:{trigger:"item"},legend:_,graphic:{type:"text",left:"center",top:"center",style:{text:x(r,"total")+"\n\n"+a.reduce((e,t)=>e+t.value,0),textAlign:"center",fill:"#333",width:30,height:30,fontSize:14}},series:[{name:t,type:"pie",radius:["30%","49%"],avoidLabelOverlap:!0,minShowLabelAngle:5,itemStyle:{borderColor:"#fff",borderWidth:2},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:a}]}})(t)),"draw_line_chart"===e&&(a=(e=>{const{data:t=[]}=e,{xData:r=[],yData:a=[]}=s(t);return{tooltip:{trigger:"axis"},legend:_,xAxis:{type:"category",data:r||[]},yAxis:{type:"value"},series:[{data:a||[],type:"line"}]}})(t)),"draw_lines_chart"===e&&(a=(e=>{const{data:t=[]}=e;let r=[];const a=[];return null==t||t.forEach(e=>{const{name:t}=e;(0,l.Kg)(t)&&(0,l.cy)(e.data)&&(0===r.length&&(r=e.data.map(e=>e.name)),a.push({name:t,type:"line",stack:"Total",data:e.data.map(e=>e.value)}))}),{tooltip:{trigger:"axis"},legend:_,xAxis:{type:"category",boundaryGap:!1,data:r||[]},yAxis:{type:"value"},series:a||[]}})(t)),(0,l.B9)(a))return r&&(a.title={text:r,left:"center"}),a},E={type:"object",properties:{title:{type:"string",description:"图表的标题, 请根据上下文生成"},data:{type:"array",description:"data是个数组有两个属性, 一个属性是name, 第二个value, 标识该项的值"}},required:["title","data"]},O=[{type:"function",function:{name:"draw_bar_chart",description:"绘制柱状图",parameters:E}},{type:"function",function:{name:"draw_x_bar_chart",description:"绘制水平柱状图",parameters:E}},{type:"function",function:{name:"draw_y_bar_chart",description:"绘制垂直柱状图",parameters:E}},{type:"function",function:{name:"draw_pie_chart",description:"绘制饼图",parameters:E}},{type:"function",function:{name:"draw_line_chart",description:"绘制折线图",parameters:E}},{type:"function",function:{name:"draw_lines_chart",description:"绘制多条折线图或者折线图堆叠",parameters:{type:"object",description:"多条折线的配置",properties:{title:{type:"string",description:"图表的标题, 请根据上下文生成"},data:{type:"array",description:"每条数据条线的相关数据",properties:{name:{type:"string",description:"名称"},data:{type:"array",description:"单条数据条线的相关数据",properties:{name:{type:"string",description:"名称"},value:{type:"number",description:"值"}}}}}},required:["title","data"]}}}],S=O.map(e=>e.function.name);var N=r(1938);const C={"deepSeek-chat-inline":{url:"https://api.deepseek.com/v1/chat/completions",model:"deepseek-chat",required:["apiKey"]}};var j=Object.defineProperty,K=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,k=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,T=(e,t)=>{for(var r in t||(t={}))A.call(t,r)&&k(e,r,t[r]);if(K)for(var r of K(t))D.call(t,r)&&k(e,r,t[r]);return e};const L=e=>{var t;const{model:r,custom:a,apiKey:n}=e;let o="",s="",i=[];const c=r&&(null==(t=C)?void 0:t[r]);return c&&(o=c.url,s=c.model,i=c.required),a&&((null==a?void 0:a.url)&&(o=a.url),(null==a?void 0:a.model)&&(s=a.model),(null==a?void 0:a.required)&&(i=a.required)),i.includes("apiKey")&&!(0,l.Kg)(n)&&console.error("LLM / Parameter apiKey are incorrect"),{sendMessage(e){return t=this,r=null,a=function*(){var t,r,a;const{messages:c,tools:u,headers:d={},params:p={}}=e;if(i.includes("apiKey")&&!(0,l.Kg)(n))return console.error("LLM / sendMessage / Parameter apiKey are incorrect"),{};if(!(0,l.vH)(c))return console.error("LLM / sendMessage / Parameter messages are incorrect"),{};if(u&&!(0,l.vH)(u))return console.error("LLM / sendMessage / Parameter tools are incorrect"),{};(0,l.vH)(u)&&!p.tools&&(p.tools=u),n&&!d.Authorization&&(d.Authorization=`Bearer ${n}`);const m=yield N.A.post(o,T({model:s,messages:c,stream:!1},p),{headers:T({"Content-Type":"application/json"},d)}).catch(e=>(console.error(e),{}));return null==(a=null==(r=null==(t=null==m?void 0:m.data)?void 0:t.choices)?void 0:r[0])?void 0:a.message},new Promise((e,n)=>{var o=e=>{try{s(a.next(e))}catch(e){n(e)}},l=e=>{try{s(a.throw(e))}catch(e){n(e)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,l);s((a=a.apply(t,r)).next())});var t,r,a}}};var M=Object.defineProperty,I=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,F=(e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{s(r.next(e))}catch(e){n(e)}},l=e=>{try{s(r.throw(e))}catch(e){n(e)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);s((r=r.apply(e,t)).next())});const B=e=>{const{model:t,custom:r,apiKey:a,SystemPrompt:n,lang:o="en_US",addChartTool:s=!0,functionCall:i={}}=e;let{tools:c=[],ChartToolTypes:u=[]}=e;if(s){const e=c.map(e=>e.function.name).filter(Boolean);S.forEach((t,r)=>{e.includes(t)||u.includes(t)||(u.push(t),c.push(O[r]))})}const d=L({model:t,custom:r,apiKey:a});if(!d)return void console.error("LLM init error");return{handleChat:e=>q(null,null,function*(){const{message:t,messages:r=[],callback:a,callbackMessage:p}=e;if(t&&r.push({role:"user",content:t}),n&&r.unshift({role:"system",content:n}),0===r.length)return;null==a||a({role:"user",content:t});const m=e.tools?e.tools:e.expandTools?[...c,...e.expandTools]:c,y=yield d.sendMessage({messages:r,tools:m});r.push(y);const h=e=>q(null,null,function*(){var t;const n=null==(t=null==e?void 0:e.tool_calls)?void 0:t[0],c=null==n?void 0:n.function;if((0,l.Kg)(null==c?void 0:c.name)){const e=((e,t={})=>{var r;try{return null!=(r=JSON.parse(e))?r:t}catch(e){return console.error(e),t}})(c.arguments);let t="";if(u.includes(c.name))try{const r={role:"assistant",content:"",toolType:c.name,chartTitle:null==e?void 0:e.title,chartData:null==e?void 0:e.data};s&&(r.chartOptions=P(c.name,((e,t)=>{for(var r in t||(t={}))z.call(t,r)&&F(e,r,t[r]);if(I)for(var r of I(t))H.call(t,r)&&F(e,r,t[r]);return e})({lang:o},e))),null==a||a(r),t=x(o,"drawChart")}catch(e){console.error(e)}else if(i[c.name]){const r=i[c.name];null==a||a({role:"assistant",content:x(o,"startFindData"),toolType:"assistant-process"}),t=yield r(e),null==a||a({role:"assistant",content:x(o,"endFindData"),toolType:"assistant-process"})}(0,l.Kg)(t)||(t=JSON.stringify(t)),r.push({role:"tool",tool_call_id:n.id,name:c.name,content:t});const p=yield d.sendMessage({messages:r,tools:m});return r.push(p),yield h(p)}return null==p||p(r),null==a?void 0:a({role:"assistant",content:(null==e?void 0:e.content)||""})});return yield h(y)})}};var U=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{s(r.next(e))}catch(e){n(e)}},l=e=>{try{s(r.throw(e))}catch(e){n(e)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);s((r=r.apply(e,t)).next())});const R=()=>{const[e,t]=(()=>{const e=n.useRef(null),t=n.useRef(null);return[e,(r=500)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{const r=e.current;r&&r.scrollTo(0,r.scrollHeight),t&&clearTimeout(t.current)},r)}]})(),[r,a]=(0,o.xI)({apiKey:"",userPrompt:"你好",messages:[],history:[]},"tool/ai-chat/cache");return n.useEffect(()=>{U(null,null,function*(){t()})},[]),{state:r,setState:a,historyRef:e,handleChat:()=>U(null,null,function*(){if(!r.userPrompt||!r.apiKey)return;const e=B({model:"deepSeek-chat-inline",apiKey:r.apiKey,lang:"en"===localStorage.language?"en_US":"zh_CN"});yield null==e?void 0:e.handleChat({message:r.userPrompt,messages:r.messages,callback:e=>{e&&((0,l.cy)(r.history)||(r.history=[]),r.history.push(e),a(r),t())}})}),handleClearHistory:()=>{a({history:[]})}}};var G=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{s(r.next(e))}catch(e){n(e)}},l=e=>{try{s(r.throw(e))}catch(e){n(e)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);s((r=r.apply(e,t)).next())});function $(){var e;const{historyRef:t,state:r,setState:o,handleChat:l,handleClearHistory:s}=R(),[i,c]=n.useState(!1);console.log(r);const u=()=>G(null,null,function*(){i||(c(!0),yield l(),c(!1))});return n.createElement("div",{className:"tool-ai-chat"},n.createElement("div",{className:"left-aside"},n.createElement("div",null,n.createElement("div",{className:"label"},"Api Key"),n.createElement(a.pd,{value:r.apiKey,onChange:e=>{const t=e.target.value;o({apiKey:t})}})),n.createElement(a.$n,{onClick:s},"Clear History")),n.createElement("div",{className:"chat-container"},n.createElement("div",{className:"chat-history",ref:t},null==(e=null==r?void 0:r.history)?void 0:e.map((e,t)=>{const{role:r,content:o,chartOptions:l,toolType:s}=e;return l?n.createElement(a.i,{key:t,classNames:[r,"chart",s]},n.createElement(a.t1,{style:{minHeight:300},options:l})):n.createElement(a.i,{key:t,className:r},n.createElement("div",{className:"content"},o))})),n.createElement("div",{className:"user-prompt"},n.createElement("textarea",{value:r.userPrompt,onKeyDown:e=>{"Enter"===e.code&&(e.preventDefault(),u())},onChange:e=>{o({userPrompt:e.target.value})}}),n.createElement("div",{className:"user-prompt-controls"},n.createElement(a.i,{className:"btn-send",classNames:{disabled:i||!(null==r?void 0:r.userPrompt)},onClick:u},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},n.createElement("path",{fill:"currentColor",d:"M20.04 2.323c1.016-.355 1.992.621 1.637 1.637l-5.925 16.93c-.385 1.098-1.915 1.16-2.387.097l-2.859-6.432l4.024-4.025a.75.75 0 0 0-1.06-1.06l-4.025 4.024l-6.432-2.859c-1.063-.473-1-2.002.097-2.387z"})))))),n.createElement("div",{className:"right-aside"}))}}}]);