import{R as u,j as t,F as m,s as b,w as l}from"./index-Cf5lDOxE.js";import{u as w}from"./index.esm-Cq3zblui.js";import{b as x}from"./index.esm-B6V8xwJH.js";const C=()=>{const[e,s]=w({method:"post",url:"http://localhost:2400/sse",values:[]},"/own/tool/sse|cache"),r=u.useRef(e);u.useEffect(()=>{r.current=e},[e]);const o=u.useRef(void 0);return{eventRef:o,state:e,setState:s,handleStartSSE:async()=>{if(!e.url)return;if(e.method==="post"){const a=await fetch(e.url,{method:"POST",headers:{"Content-Type":"text/event-stream"}});if(!a.body)throw new Error("ReadableStream not supported");const c=a.body.getReader(),d=new TextDecoder;for(x(e.values)||(e.values=[]);;){const{done:E,value:j}=await c.read();if(E)break;let i=d.decode(j,{stream:!0});if(i.startsWith("data: ")){const y=/"delta":{"role":"assistant","content":"(.*?)"},"finish_reason":null}]}/,f=i.substring(5).trim().match(y)?.[1];console.log(f),e.values.push(f),s(e);continue}const v=i.split(`
`)?.pop?.();v&&(e.values.push(v),s(e))}return}const n=new EventSource(e.url);o.current=n,n.addEventListener("customEvent",a=>{const{type:c,content:d}=JSON.parse(a.data);if(c==="stop"){n.close(),o.current=void 0,s(e);return}x(e.values)||(e.values=[]),e.values.push(d),s(e)}),n.onerror=function(a){n.close(),o.current=void 0,s(e)}},handleClearHistory:()=>{s({values:[]})},handleStopSSE:()=>{o.current?.close&&(o.current.close(),o.current=void 0,s(e))}}};function T(){const{eventRef:e,state:s,setState:r,handleStartSSE:o,handleClearHistory:h,handleStopSSE:S}=C();return t.jsxs("div",{className:"tool-sse",children:[t.jsx("h4",{children:"SSE"}),t.jsxs("div",{className:"tool-sse-box",children:[t.jsxs(m,{row:!0,className:"tool-sse-box-left",children:[t.jsx("div",{children:"SSE URL"}),t.jsx(b,{value:s.url,onChange:p=>{r({url:p.target.value})}}),t.jsx("div",{children:"Method"}),t.jsxs(m,{style:{width:"100%"},children:[t.jsx(l,{type:s.method==="post"?"primary":"default",onClick:()=>r({method:"post"}),children:"POST"}),t.jsx(l,{type:s.method==="get"?"primary":"default",onClick:()=>r({method:"get"}),children:"GET"})]}),t.jsx(l,{onClick:()=>o(),children:" Send SSE "}),t.jsx(l,{disabled:!e.current,onClick:()=>S(),children:"Stop SSE"}),t.jsx(l,{disabled:e.current,onClick:()=>h(),children:"Clear History"})]}),t.jsx("div",{className:"tool-sse-box-content",children:s?.values?.join?.("")||""})]})]})}export{T as default};
