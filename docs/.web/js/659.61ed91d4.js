"use strict";(self.webpackChunkguanruihua_github_io=self.webpackChunkguanruihua_github_io||[]).push([[659],{1724:(e,t,a)=>{a.d(t,{C:()=>s,DQ:()=>r});var l=a(1083),n=a(9108);const r=e=>{return t=null,a=null,r=function*(){return(0,n.Kg)(e.url)&&!e.url.startsWith("http")&&(e.url.startsWith("/")?e.url="http://localhost:2400"+e.url:e.url="http://localhost:2400/"+e.url),(0,l.A)(e).catch(e=>(console.error(e),{}))},new Promise((e,l)=>{var n=e=>{try{c(r.next(e))}catch(e){l(e)}},o=e=>{try{c(r.throw(e))}catch(e){l(e)}},c=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);c((r=r.apply(t,a)).next())});var t,a,r};var o=a(1742),c=a(9218);const s=e=>{(0,c.Dk)(e)?o.iU.success("Copy Success "):o.iU.error("Copy Fail ")}},4659:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var l=a(6540),n=a(7317),r=a(1724),o=(e,t,a)=>new Promise((l,n)=>{var r=e=>{try{c(a.next(e))}catch(e){n(e)}},o=e=>{try{c(a.throw(e))}catch(e){n(e)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);c((a=a.apply(e,t)).next())});const c=()=>{const e="tool/vector-data-viewer|cache",[t,a]=(0,n.xI)({active:"vector-data",databaseName:"lanceDB",selectTableName:"",tableNames:[],dataSource:[]},e),c=()=>o(null,null,function*(){var t;const l=(()=>{const t=localStorage.getItem(e)||"{}";try{return JSON.parse(t)}catch(e){}return{}})(),n=yield(0,r.DQ)({url:"http://localhost:2400/vector/tableNames",method:"get"});l.tableNames=(null==(t=null==n?void 0:n.data)?void 0:t.data)||[],a(l)});return l.useEffect(()=>{"vector-data"===t.active&&c()},[t.active]),{state:t,setState:a,handleSelectTableName:e=>o(null,null,function*(){a({selectTableName:e});const t=yield(0,r.DQ)({method:"get",url:"http://localhost:2400/vector/table/get",headers:{"Content-Type":"application/json"},params:{name:e}}),{data:l}=(null==t?void 0:t.data)||{};if(l){const t=null==l?void 0:l.map(e=>{const{id:t,text:a}=e;return{id:t,text:a}});a({selectTableName:e,dataSource:t})}})}};var s=a(1742);function i(e){var t,a;const{h:n}=e,{state:r,setState:o,handleSelectTableName:c}=n;return l.createElement("div",{className:"tool-vector-data-viewer__vector-data"},l.createElement("div",{className:"left-aside"},l.createElement("div",{className:"table-name-box"},null==(t=null==r?void 0:r.tableNames)?void 0:t.map(e=>l.createElement(s.i,{key:e,className:"table-name item",classNames:{select:e===r.selectTableName},onClick:()=>c(e)},e)))),l.createElement("div",{className:"content"},l.createElement(s.so,{style:{paddingBottom:10}},l.createElement(s.$n,null,"Refresh"),l.createElement(s.$n,null,"Remove Duplicates"),l.createElement(s.$n,null,"Clear Table"),l.createElement(s.$n,null,"Del Table")),l.createElement("div",{className:"data-viewer"},l.createElement("div",{className:"header item no"},"No."),l.createElement("div",{className:"header item id"},"ID"),l.createElement("div",{className:"header item text"},"Text"),l.createElement("div",{className:"header"}),null==(a=null==r?void 0:r.dataSource)?void 0:a.map((e,t)=>{const{id:a,text:n}=e;return l.createElement(l.Fragment,{key:a},l.createElement("div",{className:"item no"},t+1),l.createElement("div",{className:"item id"},a),l.createElement("div",{className:"item text"},n),l.createElement(s.$n,null,"Del"))}))))}var u=a(5134),d=a(9108),m=Object.defineProperty,v=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))h.call(t,a)&&f(e,a,t[a]);if(v)for(var a of v(t))p.call(t,a)&&f(e,a,t[a]);return e},E=(e,t)=>{var a={};for(var l in e)h.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&v)for(var l of v(e))t.indexOf(l)<0&&p.call(e,l)&&(a[l]=e[l]);return a},g=(e,t,a)=>new Promise((l,n)=>{var r=e=>{try{c(a.next(e))}catch(e){n(e)}},o=e=>{try{c(a.throw(e))}catch(e){n(e)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);c((a=a.apply(e,t)).next())});function x(e){var t,a;const o=l.useRef(null),[c,i]=(0,n.xI)({active:"1",name:"",fileContent:"",textChunks:[],vectors:[]},"dev/vector-data-viewer|processing-data|cache");return l.createElement("div",{className:"tool-vector-data-viewer__processing-data"},l.createElement("div",{className:"left-aside"},l.createElement("input",{ref:o,type:"file",style:{display:"none"},onChange:e=>{var t;(e=>{g(null,null,function*(){const t=yield(0,u._)(e);console.log(t),i({active:"1",fileContent:t})})})(null==(t=e.target.files)?void 0:t[0])}}),l.createElement(s.pd,{value:c.name,onChange:e=>{i({name:e.target.value||""})}}),l.createElement(s.$n,{onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()}},"Upload File"),l.createElement(s.$n,{disabled:!c.fileContent,onClick:()=>g(null,null,function*(){var e;const t=yield(0,r.DQ)({method:"post",url:"/vector/genTextChunks",params:{value:c.fileContent}}),a=(null==(e=null==t?void 0:t.data)?void 0:e.data)||[];console.log(a),i({active:"2",textChunks:a})})},"Text Chunk"),l.createElement(s.$n,{disabled:!(0,d.vH)(c.textChunks),onClick:()=>g(null,null,function*(){var e,t;const a=yield(0,r.DQ)({method:"post",url:"/vector/genTextChunkVectors",params:{name:null!=(e=c.name)?e:"tmp",list:c.textChunks}}),l=(null==(t=null==a?void 0:a.data)?void 0:t.data)||[];console.log(l),i({active:"3",vectors:l.map(e=>{const t=e,{vector:a}=t,l=E(t,["vector"]);return y({},l)})||[]})})},"Vectorization"),l.createElement(s.$n,{onClick:()=>g(null,null,function*(){var e;const t=yield(0,r.DQ)({method:"post",url:"/vector/save2VectorDB",params:{name:null!=(e=c.name)?e:"tmp",textChunks:c.textChunks||[]}}),{code:a}=(null==t?void 0:t.data)||{};console.log(null==t?void 0:t.data),200===a?s.iU.success("Save data to VectorDB Success"):s.iU.error("Save data to VectorDB Error")})},"Save Vector DB"),l.createElement(s.$n,{onClick:()=>{i({active:"1",name:"",fileContent:"",textChunks:[],vectors:[]})}},"Clear")),l.createElement("div",{className:"right-aside"},l.createElement(s.oz,{value:c.active,onChange:e=>i({active:e}),items:[{key:"1",title:"File Content",children:l.createElement("pre",null,c.fileContent)},{key:"2",title:"Chunks Data",children:l.createElement("div",{className:"chunks-data"},null==(t=null==c?void 0:c.textChunks)?void 0:t.map((e,t)=>l.createElement("div",{key:t,className:"row"},e)))},{key:"3",title:"Vector Data",children:l.createElement("div",{className:"vectors-data"},l.createElement("div",{className:"item header id"},"ID"),l.createElement("div",{className:"item header text"},"Text"),null==(a=null==c?void 0:c.vectors)?void 0:a.map((e,t)=>{const{id:a,text:n}=e;return l.createElement(l.Fragment,{key:t},l.createElement("div",{className:"item id"},a),l.createElement("div",{className:"item text"},n))}))}]})))}function C(){const e=c(),{state:t,setState:a}=e,n=[{key:"vector-data",title:"Vector Data",children:l.createElement(i,{h:e})},{key:"processing-data",title:"Processing Data",children:l.createElement(x,{h:e})}];return l.createElement("div",{className:"tool-vector-data-viewer"},l.createElement(s.oz,{value:t.active,items:n,onChange:e=>a({active:e})}))}},5134:(e,t,a)=>{a.d(t,{_:()=>o});var l=a(9108),n=a(306),r=(e,t,a)=>new Promise((l,n)=>{var r=e=>{try{c(a.next(e))}catch(e){n(e)}},o=e=>{try{c(a.throw(e))}catch(e){n(e)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);c((a=a.apply(e,t)).next())});const o=e=>r(null,null,function*(){return new Promise(t=>r(null,null,function*(){if(!(0,l.Kg)(e.name))return;const a=e.name.split(".").at(-1),o=new FileReader;if(o.onerror=function(){t("")},["md","txt"].includes(a))return o.onload=function(e){var a;const n=(null==(a=e.target)?void 0:a.result)||"";(0,l.Kg)(n)&&t(n)},void o.readAsText(e);if(["docx"].includes(a))return o.onload=function(e){var a;const l=(null==(a=e.target)?void 0:a.result)||"";n.extractRawText({arrayBuffer:l}).then(e=>{console.log(e),t((null==e?void 0:e.value)||"")}).catch(()=>{t("")})},void o.readAsArrayBuffer(e);if(["pdf"].includes(a)){const a=(e,t)=>r(null,null,function*(){const a=yield e.getPage(t),l=yield a.getTextContent(),n=[];let r="",o=-1;l.items.map(e=>{const{str:t,hasEOL:a}=e;return a?(r.length>o&&(o=r.length),n.push(r),r=""):r+=t,t});let c="",s=3*o/5;return n.forEach((e,t)=>{e.length<s?c=c+e+"\n":c+=e}),c});return o.onload=e=>r(null,null,function*(){var l;try{const n=(null==(l=e.target)?void 0:l.result)||"",r=yield window.pdfjsLib.getDocument(n).promise,o=[];console.log(r);for(let e=1;e<=r.numPages;e++)o.push(a(r,e));const c=yield Promise.all(o);console.log(c),t(c.join("\n"))}catch(e){console.error(e),t("")}}),void o.readAsArrayBuffer(e)}t("")}))})}}]);