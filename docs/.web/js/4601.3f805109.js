"use strict";(self.webpackChunkguanruihua_github_io=self.webpackChunkguanruihua_github_io||[]).push([[4601],{2912:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var r=i(5296),l=i(6045);const a=i.p+".web/img/tile.png",n=e=>{if(!e)return;let t={tileSize:200,colors:{0:16777215,2:16777215,4:16772846,8:16768477,16:16764108,32:16759739,64:16755370,128:16751001,256:16746632,512:16742263,1024:16737894,2048:16733525,4096:16729156,8192:16724787,16384:16720418,32768:16716049,65536:16711680},tweenSpeed:50};var i=new e.Class({Extends:e.Scene,initialize:function(){e.Scene.call(this,{key:"PlayGame"})},preload:function(){this.load.image("tile",a)},create:function(){this.fieldArray=[],this.fieldGroup=this.add.group();for(var e=0;e<4;e++){this.fieldArray[e]=[];for(var i=0;i<4;i++){var r=this.add.sprite(i*t.tileSize+t.tileSize/2,e*t.tileSize+t.tileSize/2,"tile");r.alpha=0,r.visible=0,this.fieldGroup.add(r);var l=this.add.text(i*t.tileSize+t.tileSize/2,e*t.tileSize+t.tileSize/2,"2",{font:"bold 64px Arial",color:"black",align:"center"});l.setOrigin(.5),l.alpha=0,l.visible=0,this.fieldGroup.add(l),this.fieldArray[e][i]={tileValue:0,tileSprite:r,tileText:l,canUpgrade:!0}}}console.log(this),this.input.keyboard.on("keydown",this.handleKey,this),this.canMove=!1,this.addTwo(),this.addTwo()},addTwo:function(){for(var i=[],r=0;r<4;r++)for(var l=0;l<4;l++)0==this.fieldArray[r][l].tileValue&&i.push({row:r,col:l});var a=e.Utils.Array.GetRandomElement(i);this.fieldArray[a.row][a.col].tileValue=2,this.fieldArray[a.row][a.col].tileSprite.visible=!0,this.fieldArray[a.row][a.col].tileText.setText("2"),this.fieldArray[a.row][a.col].tileText.visible=!0,this.tweens.add({targets:[this.fieldArray[a.row][a.col].tileSprite,this.fieldArray[a.row][a.col].tileText],alpha:1,duration:t.tweenSpeed,onComplete:function(e){e.parent.scene.canMove=!0}})},handleKey:function(e){if(this.canMove){var t=this.fieldGroup.getChildren();switch(e.code){case"ArrowLeft":case"KeyA":for(var i=0;i<t.length;i++)t[i].depth=t[i].x;this.handleMove(0,-1);break;case"ArrowRight":case"KeyD":for(i=0;i<t.length;i++)t[i].depth=l.config.width-t[i].x;this.handleMove(0,1);break;case"ArrowUp":case"KeyW":for(i=0;i<t.length;i++)t[i].depth=t[i].y;this.handleMove(-1,0);break;case"ArrowDown":case"KeyS":for(i=0;i<t.length;i++)t[i].depth=l.config.height-t[i].y;this.handleMove(1,0)}}},handleMove:function(e,t){this.canMove=!1;var i=!1;this.movingTiles=0;for(var r=0;r<4;r++)for(var l=0;l<4;l++){var a=1==t?3-l:l,n=1==e?3-r:r,s=this.fieldArray[n][a].tileValue;if(0!=s){for(var o=t,d=e;this.isInsideBoard(n+d,a+o)&&0==this.fieldArray[n+d][a+o].tileValue;)o+=t,d+=e;this.isInsideBoard(n+d,a+o)&&this.fieldArray[n+d][a+o].tileValue==s&&this.fieldArray[n+d][a+o].canUpgrade&&this.fieldArray[n][a].canUpgrade?(this.fieldArray[n+d][a+o].tileValue=2*s,this.fieldArray[n+d][a+o].canUpgrade=!1,this.fieldArray[n][a].tileValue=0,this.moveTile(this.fieldArray[n][a],n+d,a+o,Math.abs(d+o),!0),i=!0):(d-=e,0==(o-=t)&&0==d||(this.fieldArray[n+d][a+o].tileValue=s,this.fieldArray[n][a].tileValue=0,this.moveTile(this.fieldArray[n][a],n+d,a+o,Math.abs(d+o),!1),i=!0))}}i||(this.canMove=!0)},moveTile:function(e,i,r,l,a){this.movingTiles++,this.tweens.add({targets:[e.tileSprite,e.tileText],x:r*t.tileSize+t.tileSize/2,y:i*t.tileSize+t.tileSize/2,duration:t.tweenSpeed*l,onComplete:function(t){t.parent.scene.movingTiles--,a&&t.parent.scene.transformTile(e,i,r),0==t.parent.scene.movingTiles&&(t.parent.scene.resetTiles(),t.parent.scene.addTwo())}})},transformTile:function(e,i,r){this.movingTiles++,e.tileText.setText(this.fieldArray[i][r].tileValue.toString()),e.tileSprite.setTint(t.colors[this.fieldArray[i][r].tileValue]),this.tweens.add({targets:[e.tileSprite],scaleX:1.1,scaleY:1.1,duration:t.tweenSpeed,yoyo:!0,repeat:1,onComplete:function(e){e.parent.scene.movingTiles--,0==e.parent.scene.movingTiles&&(e.parent.scene.resetTiles(),e.parent.scene.addTwo())}})},resetTiles:function(){for(var e=0;e<4;e++)for(var i=0;i<4;i++)this.fieldArray[e][i].canUpgrade=!0,this.fieldArray[e][i].tileSprite.x=i*t.tileSize+t.tileSize/2,this.fieldArray[e][i].tileSprite.y=e*t.tileSize+t.tileSize/2,this.fieldArray[e][i].tileText.x=i*t.tileSize+t.tileSize/2,this.fieldArray[e][i].tileText.y=e*t.tileSize+t.tileSize/2,this.fieldArray[e][i].tileValue>0?(this.fieldArray[e][i].tileSprite.alpha=1,this.fieldArray[e][i].tileSprite.visible=!0,this.fieldArray[e][i].tileText.alpha=1,this.fieldArray[e][i].tileText.visible=!0,this.fieldArray[e][i].tileText.setText(this.fieldArray[e][i].tileValue.toString())):(this.fieldArray[e][i].tileValue=0,this.fieldArray[e][i].tileSprite.alpha=0,this.fieldArray[e][i].tileSprite.visible=!1,this.fieldArray[e][i].tileText.alpha=0,this.fieldArray[e][i].tileText.visible=!1),this.fieldArray[e][i].tileSprite.setTint(t.colors[this.fieldArray[e][i].tileValue])},isInsideBoard:function(e,t){return e>=0&&t>=0&&e<4&&t<4}}),r={type:e.WEBGL,width:4*t.tileSize,height:4*t.tileSize,backgroundColor:4473924,scene:[i]};let l=new e.Game(r);function n(){var e=document.querySelector("canvas");if(e){var t=window.innerWidth,i=window.innerHeight,r=t/i,a=l.config.width/l.config.height;r<a?(e.style.width=t+"px",e.style.height=t/a+"px"):(e.style.width=i*a+"px",e.style.height=i+"px")}}window.focus(),n(),window.addEventListener("resize",n,!1)},s=()=>{const[e,t]=r.useState(null),[i,a]=(0,l.xI)({});return r.useEffect(()=>{const e="/js/phaser.min.js",i=document.createElement("script");return i.src=e,i.onload=()=>{console.log(e,"已加载");const i=window.Phaser;t(i),i&&n(i)},document.body.appendChild(i),()=>{document.body.removeChild(i)}},[]),{state:i,setState:a}};function o(){const{state:e,setState:t}=s();return r.createElement("div",{className:"game-2048"},"2048")}},6045:(e,t,i)=>{i.d(t,{xI:()=>h});var r=i(5296);function l(e){return null==e||e!=e}function a(e){try{if("object"==typeof(t=e)&&!l(t)&&/Iterator\]$/.test(t.toString()))return"Iterator";const i=Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1];return"Number"===i&&isNaN(e)?"NaN":i}catch(e){return"Undefined"}var t}function n(e){return"string"==typeof e}const s=e=>"number"==typeof e&&"Number"===a(e);function o(e){return!l(e)&&(function(e){return Array.isArray(e)}(e)&&e.length>0)}const d="undefined"!=typeof window;function h(e={},t,i=localStorage){const[l,a]=(0,r.useState)(e),d=e=>{if(a(e),t)try{i.setItem(t,JSON.stringify(e))}catch(e){return void console.warn(e)}};return(0,r.useEffect)(()=>{if(t)try{const e=i.getItem(t);if(!e||"{}"===e)return;d(JSON.parse(e))}catch(e){return}},[t,i]),[l,(e,t=!1)=>{const i="function"==typeof e?e(l):e;d(t?i:{...l,...i})},t=>{if(o(t)){const i={...l};return t.forEach(t=>{(n(t)||s(t))&&(i[t]=e[t])}),void d(i)}d(e)}]}d&&window?.navigator?.userAgent&&/iP(ad|hone|od)/.test(window.navigator.userAgent)}}]);