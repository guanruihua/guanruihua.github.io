import{c as S,R as E,j as _}from"./index-DN-J_UY2.js";import{u as w}from"./index.esm-BD6zwB7Y.js";import"./index.esm-vp3mBawv.js";import{c as C}from"./index.esm-DEqtexvw.js";const N=[{id:"A",label:"Christmas",edges:[{id:"A-B",start:"A",end:"B",label:"Get money"}]},{id:"B",label:"Go shopping",edges:[{id:"B-C",start:"B",end:"C"}]},{id:"C",label:"Let me think",edges:[{id:"C-D",start:"C",end:"D",label:"One"},{id:"C-E",start:"C",end:"E",label:"Two"},{id:"C-F",start:"C",end:"F",label:"Three"},{end:"E2"}]},{id:"D",label:"Laptop"},{id:"E",label:"iPhone"},{id:"E2",label:"iPhone17"},{id:"F",label:"Card",edges:[{end:"G"}]},{id:"G",label:"Others"}],v=async t=>{const e={nodes:[],edges:[],Next:{}};return t.forEach((r,i)=>{const{edges:o}=r;r.id||(r.id=`__node_${i}`),e.nodes.push(r),o?.forEach(n=>{n.start||(n.start=r.id),n.id||(n.id=`__edge__${n.start}-${n.end}`),e.edges.push(n),e.Next[r.id]||(e.Next[r.id]=[]),e.Next[r.id].push(n.end)})}),e},X=t=>document.querySelector(t).getBoundingClientRect(),Y=async(t,e)=>{const r=e?.current?.getBoundingClientRect(),i={rootRect:r,Rect:{},Size:{},XY:{},EdgeD:{}};t.nodes.forEach(h=>{const{id:c}=h,l=X(`.d-node[data-id="${c}"]`);i.Rect[c]=l});const o=120,n=30,{height:g}=r,R=(h,c=0)=>{if(!h)return;const{width:l}=i.Rect[h],s=t.Next?.[h];if(!s)return;const f=s.length;if(f===1){const a=i.Rect[h],d=s[0];i.XY[d]=[c+o,(g-a.height)/2],R(d,c+l+o)}else if(f>1){let a=0,d=0;const m=s.map((u,y)=>{const $=i.Rect[u];return a+=(y+1===f?0:n)+$.height,d<$.width&&(d=$.width),$.height});s?.forEach((u,y)=>{i.XY[u]=[c+o,(g-a)/2+n*y+m.slice(0,y).reduce(($=0,j)=>$+j,0)],R(u,c+d+o)})}return s},p=t.nodes.at(0).id,x=i.Rect[p],D=[40,(g-x.height)/2];i.XY[p]=D,R(p,D[0]+x.width),i.EdgeD={};const b=h=>{const{start:c,end:l}=h,[s,f]=i.XY[c],a=i.Rect[c],[d,m]=i.XY[l],u=i.Rect[c];return{x1:s+a.width,y1:f+a.height/2,x2:d,y2:m+u.height/2}};return t.edges?.forEach(h=>{const{id:c}=h,{x1:l,y1:s,x2:f,y2:a}=b(h);if(Math.abs(s-a)<3)i.EdgeD[c]=`M ${l} ${s}, ${f} ${a}`;else{const d=Math.abs(a-s)*4/5,m=(f-l)*3/5;let u="";s>a?u=`M ${l} ${s} C ${l+m} ${s-d}, ${f-m} ${a}, ${f} ${a}`:u=`M ${l} ${s} C ${l+m} ${s+d}, ${f-m} ${a}, ${f} ${a}`,i.EdgeD[c]=u}}),i},B=()=>{const t=S.c(27),e=E.useRef(null);let r;t[0]===Symbol.for("react.memo_cache_sentinel")?(r={initData:!1,initRect:!1,updateRender:-1},t[0]=r):r=t[0];const[i,o]=w(r);let n;t[1]===Symbol.for("react.memo_cache_sentinel")?(n={nodes:[],edges:[],Next:{}},t[1]=n):n=t[1];const[g,R]=w(n);let p;t[2]===Symbol.for("react.memo_cache_sentinel")?(p={Next:{},Rect:{},rootRect:{},layout:{}},t[2]=p):p=t[2];const[x,D]=w(p);let b;t[3]!==R||t[4]!==o?(b=async()=>{console.log("init data"),o({initData:!1,initRect:!1,updateRender:-1});const u=await v(N);R(u),o({initData:!0,initRect:!1,updateRender:-1})},t[3]=R,t[4]=o,t[5]=b):b=t[5];const h=b;let c;t[6]!==h||t[7]!==i.initData?(c=()=>{!i.initData&&h()},t[6]=h,t[7]=i.initData,t[8]=c):c=t[8];let l;t[9]!==i.initData?(l=[N,i.initData],t[9]=i.initData,t[10]=l):l=t[10],E.useEffect(c,l);let s;t[11]!==D||t[12]!==o||t[13]!==g?(s=async()=>{console.log("init rect");const u=await Y(g,e);o({initData:!0,initRect:!0,updateRender:-1}),D(u)},t[11]=D,t[12]=o,t[13]=g,t[14]=s):s=t[14];const f=s;let a;t[15]!==f||t[16]!==i.initData||t[17]!==i.initRect?(a=()=>{i.initData&&!i.initRect&&f()},t[15]=f,t[16]=i.initData,t[17]=i.initRect,t[18]=a):a=t[18];let d;t[19]!==i.initData||t[20]!==i.initRect||t[21]!==i.updateRender?(d=[i.initData,i.initRect,i.updateRender],t[19]=i.initData,t[20]=i.initRect,t[21]=i.updateRender,t[22]=d):d=t[22],E.useEffect(a,d);let m;return t[23]!==x||t[24]!==R||t[25]!==g?(m={rootRef:e,layout:x,state:g,setState:R},t[23]=x,t[24]=R,t[25]=g,t[26]=m):m=t[26],m},L=t=>{const e=S.c(21),{node:r,state:i,layout:o}=t,{id:n,label:g,type:R}=r,p=R===void 0?"default":R;let x;e[0]!==n||e[1]!==o?.Rect?(x=o?.Rect?.[n]||{},e[0]=n,e[1]=o?.Rect,e[2]=x):x=e[2];const{width:D,height:b}=x,h=D===void 0?"auto":D,c=b===void 0?"auto":b;let l;e[3]!==n||e[4]!==o?.XY?(l=o?.XY?.[n]||[],e[3]=n,e[4]=o?.XY,e[5]=l):l=e[5];const[s,f]=l;let a;e[6]!==s||e[7]!==f?(a=C(s)&&C(f)?`translate(${s}px, ${f}px)`:void 0,e[6]=s,e[7]=f,e[8]=a):a=e[8];let d;e[9]!==c||e[10]!==a||e[11]!==h?(d={width:h,height:c,transform:a},e[9]=c,e[10]=a,e[11]=h,e[12]=d):d=e[12];const m=i?.status?.[n]??"default",u=g??n;let y;e[13]!==n||e[14]!==m||e[15]!==u||e[16]!==p?(y=_.jsx("div",{className:"d-node","data-id":n,"data-type":p,"data-status":m,children:u}),e[13]=n,e[14]=m,e[15]=u,e[16]=p,e[17]=y):y=e[17];let $;return e[18]!==d||e[19]!==y?($=_.jsx("div",{className:"d-node-box",style:d,children:y}),e[18]=d,e[19]=y,e[20]=$):$=e[20],$};function P(){const{rootRef:t,state:e,layout:r}=B();return _.jsx("div",{className:"animation__mermaid-flowchart",children:_.jsxs("div",{className:"animation__mermaid-flowchart-container",ref:t,children:[_.jsx("svg",{className:"animation__mermaid-flowchart-edge-box",children:e.edges?.map((i,o)=>{const{id:n}=i;return _.jsx("path",{"data-id":n,fill:"none",d:r.EdgeD?.[n]},o)})}),_.jsx("div",{className:"animation__mermaid-flowchart-node-box",children:e.nodes.map((i,o)=>_.jsx(L,{node:i,state:e,layout:r},o))})]})})}export{P as default};
