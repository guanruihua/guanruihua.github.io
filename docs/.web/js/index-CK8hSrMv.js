import{r as j,c as y,j as n,s as E,w as N}from"./index-DN-J_UY2.js";import{u as M}from"./index.esm-BD6zwB7Y.js";import{p as W,t as _}from"./index.esm-Bb1-czql.js";function U(u,e){const[t,c]=j.useState(!1),[l,S]=M({messages:[]},e),{messages:m=[]}=l,r=j.useRef(null),f={messages:m,async onMessage(s){const o=W(await s.data?.text?.(),void 0);if(console.log(o,this.messages),o&&o.id){const a=this?.messages||[];if(a.map(i=>i.id).includes(o.id))return;a.push(o),S({messages:a}),this.messages=a}}};return j.useEffect(()=>{const s=new WebSocket(u);return s.onopen=()=>{c(!0),console.log("WebSocket connected")},s.onclose=()=>{c(!1),console.log("WebSocket disconnected")},s.onmessage=f.onMessage,s.onerror=o=>{console.error("WebSocket error:",o)},r.current=s,()=>{s.close()}},[u]),{isReady:t,messages:m,sendMessage:s=>r.current&&t?(r.current.send(s),!0):!1}}function k(u){const e=y.c(27),{name:t}=u;let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c={value:""},e[0]=c):c=e[0];const[l,S]=M(c),{sendMessage:m,messages:r}=U("ws://localhost:2410","/tool/webSocket/cache|"+t);let f;e[1]!==r?(f=r===void 0?[]:r,e[1]=r,e[2]=f):f=e[2];const p=f;let s;e[3]!==t||e[4]!==l.value||e[5]!==m?(s=()=>{const b={id:Date.now(),type:"message",name:t,content:l.value||""};m(_(b))},e[3]=t,e[4]=l.value,e[5]=m,e[6]=s):s=e[6];const o=s;let a;e[7]!==t?(a=n.jsx("h3",{children:n.jsx("span",{children:t})}),e[7]=t,e[8]=a):a=e[8];let d;e[9]!==p?(d=p?.map(C),e[9]=p,e[10]=d):d=e[10];let i;e[11]!==d?(i=n.jsx("div",{className:"webSocket-user-message-box",children:d}),e[11]=d,e[12]=i):i=e[12];let g;e[13]!==S?(g=b=>{const R=b.target.value;S({value:R})},e[13]=S,e[14]=g):g=e[14];let x;e[15]!==l.value||e[16]!==g?(x=n.jsx(E,{value:l.value,onChange:g}),e[15]=l.value,e[16]=g,e[17]=x):x=e[17];let h;e[18]!==o?(h=n.jsx(N,{onClick:()=>o(),children:"Send"}),e[18]=o,e[19]=h):h=e[19];let v;e[20]!==x||e[21]!==h?(v=n.jsxs("div",{className:"webSocket-user-content",children:[x,h]}),e[20]=x,e[21]=h,e[22]=v):v=e[22];let w;return e[23]!==v||e[24]!==a||e[25]!==i?(w=n.jsxs("div",{className:"webSocket-user",children:[a,i,v]}),e[23]=v,e[24]=a,e[25]=i,e[26]=w):w=e[26],w}function C(u,e){const{name:t,content:c}=u;return n.jsxs("div",{children:[t,"-",c]},e)}function I(){return n.jsx("div",{className:"tool-webSocket",children:n.jsxs("div",{className:"tool-webSocket-box",children:[n.jsx(k,{name:"User1"}),n.jsx(k,{name:"User2 "})]})})}export{I as default};
