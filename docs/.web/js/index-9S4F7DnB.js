import{R as E,j as I}from"./index-DT8AHoJV.js";import{u as p}from"./index.esm-BgEDtHeL.js";const o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkUzQkU1QUFFMUJBNDExRTg5RDgyQUNGRDZBNURCMUZEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkUzQkU1QUFGMUJBNDExRTg5RDgyQUNGRDZBNURCMUZEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTNCRTVBQUMxQkE0MTFFODlEODJBQ0ZENkE1REIxRkQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTNCRTVBQUQxQkE0MTFFODlEODJBQ0ZENkE1REIxRkQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz79vBiOAAAE3UlEQVR42uzaP0ycdRjA8feOP5YUJqwLyXWksSyaJgxdykRYmnTR2s1BHRw6iOjeJupgTePK2Kh0qcDApi6sTjSBRQq1i9qEvwEpvfP54Z25UBto+x65g88neXrc9Y42773f/N73vStUKpUM+H9FmwAEAgIBgYBAQCAgEBAICAROnvacfk8p5lrMUMybMWdiXrN5OUIbMb/HLMX8EjMRs/iqv7Rw2K+aFAqFZx6L16Ywvox5J6bNe0QTKVcj+Tz23eXnPemg/f+lA4nXXY6bOzE93guafGX5MPbf748skHjN9bi5tf8c5unTp9nW1la2s7OT7e7uZuVyOfNlSI5S2k/b2tr2prOzM+vq6ko/p53wk/i7bxoeSDz/3bhJNRbqw1hfX9+LA5pNiqSnp6cSobwX+/FEwwKpnnPcj+muPb69vZ2trKxYKWj6leX06dPbEUp//TnJQfvti17F+qI+js3NzWxtbc3Wp+mlEDY2Nk7Nzc39GHffPuzrii/wD5yNm6u1++lwShy0mlKp9Nbw8PDHuQdSjaNYO+dYXV21tWk5xWIxO3fuXLrAVMo7kKHaD+mE3DkHrWpwcLAzbr7KO5CB2urhahWtLFaQdJM+3D6bZyCv1849oJX19vbW9v2reQay992q9CEgtLKOjo5nThvyCGRP+oQcjomB3ANJXx+BY+JM7oG4esUx0pl7IHCSCAQEAgIBgYBAQCAgEBAICAQEAggEBAICAYGAQEAgIBAQCAgEBAIIBAQCAgGBgEBAICAQEAgIBBAICAQEAgIBgYBAQCAgEBAICAQQCAgEBAICAYGAQEAgIBAQCCAQEAgIBAQCAgGBgEBAICAQEAggEBAICAQEAgIBgYBAQCAgEEAgIBAQCAgEBAICAYGAQEAgIBBAICAQEAgIBAQCAgGBgEBAIIBAQCAgEBAICAQEAgIBgYBAQCCAQEAgIBAQCAgEBAICAYGAQEAggEBAICAQEAgIBAQCAgGBgEAAgYBAQCAgEBAICAQEAgIBgYBAAIGAQEAgIBAQCAgEBAICAYEAAgGBgEBAICAQEAgIBAQCAgGBAAIBgYBAQCAgEBAICAROcCB/21wcB0+ePGlIIH/ZtBwHjx8/bkgg921ajoP5+fmGBPJT+qNQKNjCtLTZ2dnajzt5BjIRUy4WndfTusrlcjY1NVW7+2dugcTK8SBu7ra3t9vKtKzp6ens4cOHtbtzea4gyWeHWZagGW1ubmY3b96sf+jnXAOJVWR5cXFxtFKp2Nq0lLTPjo6OZo8ePfrvaKt62pDrCpJduHDh2/Hx8V/TsRy0Shw3btzIJicn6x++G/PgwEXhsKvBvqtXpZGRkYXbt2+f6u7u9g7Q1IdVY2Nj2b179+of3og5H7N80P7/speklmdmZt4fGhqqpCqtJjSbtE+mffPSpUv740hFfJD24UMtDC+5gtRcj7nV19dXvHLlSnbx4sWsv78/6+3tzTo6OrxLHJn09ZH0CfnCwsLe5xzpatXS0tIzR1sxn8Z8XX/41chAkssxd2J6vE00sXRY9VHMd/vPTxpxiFUvfeoyEPND9coANNXRVnXfPL8/jqM4xNqvFHMtZqj6H3ojxrEWR3q0FfNH9u93B9PnHOlq1W/Pe3Juh1hwEvliFQgEBAICAYGAQKD5/SPAAIKyTOJsoEjGAAAAAElFTkSuQmCC",m=(g,y)=>{if(!g)return;let r={tileSize:200,colors:{0:16777215,2:16777215,4:16772846,8:16768477,16:16764108,32:16759739,64:16755370,128:16751001,256:16746632,512:16742263,1024:16737894,2048:16733525,4096:16729156,8192:16724787,16384:16720418,32768:16716049,65536:16711680},tweenSpeed:50};var v=new g.Class({Extends:g.Scene,initialize:function(){g.Scene.call(this,{key:"PlayGame"})},preload:function(){this.load.image("tile",o)},create:function(){this.fieldArray=[],this.fieldGroup=this.add.group();for(var i=0;i<4;i++){this.fieldArray[i]=[];for(var e=0;e<4;e++){var t=this.add.sprite(e*r.tileSize+r.tileSize/2,i*r.tileSize+r.tileSize/2,"tile");t.alpha=0,t.visible=0,this.fieldGroup.add(t);var a=this.add.text(e*r.tileSize+r.tileSize/2,i*r.tileSize+r.tileSize/2,"2",{font:"bold 64px Arial",color:"black",align:"center"});a.setOrigin(.5),a.alpha=0,a.visible=0,this.fieldGroup.add(a),this.fieldArray[i][e]={tileValue:0,tileSprite:t,tileText:a,canUpgrade:!0}}}console.log(this),this.input.keyboard.on("keydown",this.handleKey,this),this.canMove=!1,this.addTwo(),this.addTwo()},addTwo:function(){for(var i=[],e=0;e<4;e++)for(var t=0;t<4;t++)this.fieldArray[e][t].tileValue==0&&i.push({row:e,col:t});var a=g.Utils.Array.GetRandomElement(i);this.fieldArray[a.row][a.col].tileValue=2,this.fieldArray[a.row][a.col].tileSprite.visible=!0,this.fieldArray[a.row][a.col].tileText.setText("2"),this.fieldArray[a.row][a.col].tileText.visible=!0,this.tweens.add({targets:[this.fieldArray[a.row][a.col].tileSprite,this.fieldArray[a.row][a.col].tileText],alpha:1,duration:r.tweenSpeed,onComplete:function(d){d.parent.scene.canMove=!0}})},handleKey:function(i){if(this.canMove){var e=this.fieldGroup.getChildren();switch(i.code){case"ArrowLeft":case"KeyA":for(var t=0;t<e.length;t++)e[t].depth=e[t].x;this.handleMove(0,-1);break;case"ArrowRight":case"KeyD":for(var t=0;t<e.length;t++)e[t].depth=f.config.width-e[t].x;this.handleMove(0,1);break;case"ArrowUp":case"KeyW":for(var t=0;t<e.length;t++)e[t].depth=e[t].y;this.handleMove(-1,0);break;case"ArrowDown":case"KeyS":for(var t=0;t<e.length;t++)e[t].depth=f.config.height-e[t].y;this.handleMove(1,0);break}}},handleMove:function(i,e){this.canMove=!1;var t=!1;this.movingTiles=0;for(var a=0;a<4;a++)for(var d=0;d<4;d++){var A=e==1?3-d:d,l=i==1?3-a:a,u=this.fieldArray[l][A].tileValue;if(u!=0){for(var s=e,n=i;this.isInsideBoard(l+n,A+s)&&this.fieldArray[l+n][A+s].tileValue==0;)s+=e,n+=i;this.isInsideBoard(l+n,A+s)&&this.fieldArray[l+n][A+s].tileValue==u&&this.fieldArray[l+n][A+s].canUpgrade&&this.fieldArray[l][A].canUpgrade?(this.fieldArray[l+n][A+s].tileValue=u*2,this.fieldArray[l+n][A+s].canUpgrade=!1,this.fieldArray[l][A].tileValue=0,this.moveTile(this.fieldArray[l][A],l+n,A+s,Math.abs(n+s),!0),t=!0):(s=s-e,n=n-i,(s!=0||n!=0)&&(this.fieldArray[l+n][A+s].tileValue=u,this.fieldArray[l][A].tileValue=0,this.moveTile(this.fieldArray[l][A],l+n,A+s,Math.abs(n+s),!1),t=!0))}}t||(this.canMove=!0)},moveTile:function(i,e,t,a,d){this.movingTiles++,this.tweens.add({targets:[i.tileSprite,i.tileText],x:t*r.tileSize+r.tileSize/2,y:e*r.tileSize+r.tileSize/2,duration:r.tweenSpeed*a,onComplete:function(A){A.parent.scene.movingTiles--,d&&A.parent.scene.transformTile(i,e,t),A.parent.scene.movingTiles==0&&(A.parent.scene.resetTiles(),A.parent.scene.addTwo())}})},transformTile:function(i,e,t){this.movingTiles++,i.tileText.setText(this.fieldArray[e][t].tileValue.toString()),i.tileSprite.setTint(r.colors[this.fieldArray[e][t].tileValue]),this.tweens.add({targets:[i.tileSprite],scaleX:1.1,scaleY:1.1,duration:r.tweenSpeed,yoyo:!0,repeat:1,onComplete:function(a){a.parent.scene.movingTiles--,a.parent.scene.movingTiles==0&&(a.parent.scene.resetTiles(),a.parent.scene.addTwo())}})},resetTiles:function(){for(var i=0;i<4;i++)for(var e=0;e<4;e++)this.fieldArray[i][e].canUpgrade=!0,this.fieldArray[i][e].tileSprite.x=e*r.tileSize+r.tileSize/2,this.fieldArray[i][e].tileSprite.y=i*r.tileSize+r.tileSize/2,this.fieldArray[i][e].tileText.x=e*r.tileSize+r.tileSize/2,this.fieldArray[i][e].tileText.y=i*r.tileSize+r.tileSize/2,this.fieldArray[i][e].tileValue>0?(this.fieldArray[i][e].tileSprite.alpha=1,this.fieldArray[i][e].tileSprite.visible=!0,this.fieldArray[i][e].tileText.alpha=1,this.fieldArray[i][e].tileText.visible=!0,this.fieldArray[i][e].tileText.setText(this.fieldArray[i][e].tileValue.toString())):(this.fieldArray[i][e].tileValue=0,this.fieldArray[i][e].tileSprite.alpha=0,this.fieldArray[i][e].tileSprite.visible=!1,this.fieldArray[i][e].tileText.alpha=0,this.fieldArray[i][e].tileText.visible=!1),this.fieldArray[i][e].tileSprite.setTint(r.colors[this.fieldArray[i][e].tileValue])},isInsideBoard:function(i,e){return i>=0&&e>=0&&i<4&&e<4}}),h={type:g.WEBGL,width:r.tileSize*4,height:r.tileSize*4,backgroundColor:4473924,parent:y,scene:[v]};let f=new g.Game(h);window.focus();function B(){var i=document.querySelector("canvas");if(i){var e=window.innerWidth,t=window.innerHeight,a=e/t,d=f.config.width/f.config.height;a<d?(i.style.width=e+"px",i.style.height=e/d+"px"):(i.style.width=t*d+"px",i.style.height=t+"px")}}B(),window.addEventListener("resize",B,!1)},b=()=>{const[g,y]=p({}),r=E.useRef(null);return E.useEffect(()=>{if(!r.current)return;const v="/js/phaser.min.js",h=document.createElement("script");return h.src=v,h.onload=()=>{console.log(v,"已加载");const f=window.Phaser;f&&m(f,r.current)},document.body.appendChild(h),()=>{document.body.removeChild(h)}},[r.current]),{ref:r,state:g,setState:y}};function c(){const{ref:g}=b();return I.jsx("div",{className:"game__2048",children:I.jsx("div",{ref:g})})}export{c as default};
