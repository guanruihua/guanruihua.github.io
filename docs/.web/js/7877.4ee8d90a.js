"use strict";(self.webpackChunkguanruihua_github_io=self.webpackChunkguanruihua_github_io||[]).push([[7877],{7877:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var l=n(5296),o=n(8780),r=n(6045),a=n(1814);const s=()=>{const[e,t]=(0,r.xI)({method:"post",url:"http://localhost:2400/sse",values:[]},"/tool/sse|cache"),n=l.useRef(e);l.useEffect(()=>{n.current=e},[e]);const o=l.useRef(void 0);return{eventRef:o,state:e,setState:t,handleStartSSE:()=>{return n=null,l=null,r=function*(){var n,l,r;if(!e.url)return;if("post"===e.method){const o=yield fetch(e.url,{method:"POST",headers:{"Content-Type":"text/event-stream"}});if(!o.body)throw new Error("ReadableStream not supported");const s=o.body.getReader(),u=new TextDecoder;for((0,a.cy)(e.values)||(e.values=[]);;){const{done:o,value:a}=yield s.read();if(o)break;let c=u.decode(a,{stream:!0});if(c.startsWith("data: ")){const l=/"delta":{"role":"assistant","content":"(.*?)"},"finish_reason":null}]}/,o=null==(n=c.substring(5).trim().match(l))?void 0:n[1];console.log(o),e.values.push(o),t(e);continue}const d=null==(r=null==(l=c.split("\n"))?void 0:l.pop)?void 0:r.call(l);d&&(e.values.push(d),t(e))}return}const s=new EventSource(e.url);o.current=s,s.addEventListener("customEvent",n=>{const{type:l,content:r}=JSON.parse(n.data);if("stop"===l)return s.close(),o.current=void 0,void t(e);(0,a.cy)(e.values)||(e.values=[]),e.values.push(r),t(e)}),s.onerror=function(n){s.close(),o.current=void 0,t(e)}},new Promise((e,t)=>{var o=e=>{try{s(r.next(e))}catch(e){t(e)}},a=e=>{try{s(r.throw(e))}catch(e){t(e)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(n,l)).next())});var n,l,r},handleClearHistory:()=>{t({values:[]})},handleStopSSE:()=>{var n;(null==(n=o.current)?void 0:n.close)&&(o.current.close(),o.current=void 0,t(e))}}};function u(){var e,t;const{eventRef:n,state:r,setState:a,handleStartSSE:u,handleClearHistory:c,handleStopSSE:d}=s();return l.createElement("div",{className:"tool-sse"},l.createElement("h4",null,"SSE"),l.createElement("div",{className:"tool-sse-box"},l.createElement(o.so,{row:!0,className:"tool-sse-box-left"},l.createElement("div",null,"SSE URL"),l.createElement(o.pd,{value:r.url,onChange:e=>{a({url:e.target.value})}}),l.createElement("div",null,"Method"),l.createElement(o.so,{style:{width:"100%"}},l.createElement(o.$n,{type:"post"===r.method?"primary":"default",onClick:()=>a({method:"post"})},"POST"),l.createElement(o.$n,{type:"get"===r.method?"primary":"default",onClick:()=>a({method:"get"})},"GET")),l.createElement(o.$n,{onClick:()=>u()}," Send SSE "),l.createElement(o.$n,{disabled:!n.current,onClick:()=>d()},"Stop SSE"),l.createElement(o.$n,{disabled:n.current,onClick:()=>c()},"Clear History")),l.createElement("div",{className:"tool-sse-box-content"},(null==(t=null==(e=null==r?void 0:r.values)?void 0:e.join)?void 0:t.call(e,""))||"")))}}}]);