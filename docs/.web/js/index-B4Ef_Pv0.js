import{c as K,R as J,j as s,g as M,w as g,F as Q,v as q,s as W,L}from"./index-C3OrwJWL.js";import{u as U}from"./index.esm-CIUewgvG.js";import{r as T}from"./req-CSx9pCJt.js";import"./index.esm-vp3mBawv.js";import{b as X,a as Y}from"./index.esm-B6V8xwJH.js";import{g as Z}from"./helper-DFktppUZ.js";import"./conf-BIv_urOD.js";import"./index.esm-Bb1-czql.js";const ee=()=>{const t=K.c(25);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e={active:"vector-data",databaseName:"lanceDB",selectTableName:"",tableNames:[],dataSource:[]},t[0]=e):e=t[0];const[a,l]=U(e,"tool/vector-data-viewer|cache"),f=te;let v,u,x,r,n,c;t[1]!==l||t[2]!==a.selectTableName?(n=async i=>{const m=i===void 0?"table":i;if(m==="table"&&a.selectTableName&&c(a.selectTableName),m==="tableNames"){const o=f(),k=(await T({url:"vector/tableNames"}))?.data?.data;if(k){if(o.tableNames=k||[],o.selectTableName=k?.[0]||"",o.selectTableName){const b=await T({url:"/vector/table/get",params:{name:o.selectTableName}}),{data:y}=b?.data||{};y&&(o.dataSource=y?.map(ae))}l(o)}}},v=async()=>{const i=await T({method:"post",url:"/vector/clearTable",params:{tableName:a.selectTableName}});console.log(i?.data),await n("table")},x=async()=>{const i=await T({method:"post",url:"/vector/delTable",params:{tableName:a.selectTableName}});console.log(i?.data),await n("tableNames")},r=async i=>{const m=await T({method:"post",url:"/vector/delTableData",params:{tableName:a.selectTableName,data:X(i)?i:[i]}});console.log(m?.data),await n("table")},u=se,c=async i=>{l({selectTableName:i});const m=await T({url:"/vector/table/get",params:{name:i}}),{data:o}=m?.data||{};if(o){const j=o?.map(le);l({selectTableName:i,dataSource:j})}},t[1]=l,t[2]=a.selectTableName,t[3]=v,t[4]=u,t[5]=x,t[6]=r,t[7]=n,t[8]=c):(v=t[3],u=t[4],x=t[5],r=t[6],n=t[7],c=t[8]);let d;t[9]!==l?(d=async()=>{const i=f(),o=(await T({url:"vector/tableNames"}))?.data?.data;o&&(i.tableNames=o||[],l(i))},t[9]=l,t[10]=d):d=t[10];const h=d;let p;t[11]!==h||t[12]!==a.active?(p=()=>{a.active==="vector-data"&&h()},t[11]=h,t[12]=a.active,t[13]=p):p=t[13];let C;t[14]!==a.active?(C=[a.active],t[14]=a.active,t[15]=C):C=t[15],J.useEffect(p,C);let N;return t[16]!==v||t[17]!==u||t[18]!==x||t[19]!==r||t[20]!==n||t[21]!==c||t[22]!==l||t[23]!==a?(N={state:a,setState:l,handleSelectTableName:c,handleClearTableData:v,handleRefresh:n,handleDelTable:x,handleDelTableData:r,handleDelDuplicates:u},t[16]=v,t[17]=u,t[18]=x,t[19]=r,t[20]=n,t[21]=c,t[22]=l,t[23]=a,t[24]=N):N=t[24],N};function te(){const t=localStorage.getItem("tool/vector-data-viewer|cache")||"{}";try{return JSON.parse(t)}catch{}return{}}function ae(t){const{id:e,text:a,key:l}=t;return{id:e,text:a,key:l}}async function se(){}function le(t){const{id:e,text:a,key:l}=t;return{id:e,text:a,key:l}}function ne(t){const e=K.c(32),{h:a}=t,{state:l,handleSelectTableName:f}=a;let v;e[0]!==f||e[1]!==l?(v=l?.tableNames?.map(b=>s.jsx(M,{className:"table-name item",classNames:{select:b===l.selectTableName},onClick:()=>f(b),children:b},b)),e[0]=f,e[1]=l,e[2]=v):v=e[2];let u;e[3]!==v?(u=s.jsx("div",{className:"left-aside",children:s.jsx("div",{className:"table-name-box",children:v})}),e[3]=v,e[4]=u):u=e[4];let x;e[5]===Symbol.for("react.memo_cache_sentinel")?(x={paddingBottom:10},e[5]=x):x=e[5];let r;e[6]!==a?(r=s.jsx(g,{onClick:()=>a.handleRefresh("table"),children:"Refresh"}),e[6]=a,e[7]=r):r=e[7];let n;e[8]!==a?(n=s.jsx(g,{onClick:()=>a.handleClearTableData(),children:"Clear Table"}),e[8]=a,e[9]=n):n=e[9];let c;e[10]!==a?(c=s.jsx(g,{onClick:()=>a.handleDelTable(),children:"Del Table"}),e[10]=a,e[11]=c):c=e[11];let d;e[12]!==r||e[13]!==n||e[14]!==c?(d=s.jsxs(Q,{style:x,children:[r,n,c]}),e[12]=r,e[13]=n,e[14]=c,e[15]=d):d=e[15];let h,p,C,N,i;e[16]===Symbol.for("react.memo_cache_sentinel")?(C=s.jsx("div",{className:"header item no",children:"No."}),N=s.jsx("div",{className:"header item id",children:"ID"}),i=s.jsx("div",{className:"header item key",children:"Key"}),h=s.jsx("div",{className:"header item text",children:"Text"}),p=s.jsx("div",{className:"header"}),e[16]=h,e[17]=p,e[18]=C,e[19]=N,e[20]=i):(h=e[16],p=e[17],C=e[18],N=e[19],i=e[20]);let m;e[21]!==a||e[22]!==l?.dataSource?(m=l?.dataSource?.map((b,y)=>{const{id:_,key:w,text:S}=b;return s.jsxs(J.Fragment,{children:[s.jsx("div",{className:"item no",children:y+1}),s.jsx("div",{className:"item id",children:_}),s.jsx("div",{className:"item key",children:w}),s.jsx("div",{className:"item text",children:S}),s.jsx(g,{onClick:()=>a.handleDelTableData(b),children:"Del"})]},_)}),e[21]=a,e[22]=l?.dataSource,e[23]=m):m=e[23];let o;e[24]!==m?(o=s.jsxs("div",{className:"data-viewer",children:[C,N,i,h,p,m]}),e[24]=m,e[25]=o):o=e[25];let j;e[26]!==o||e[27]!==d?(j=s.jsxs("div",{className:"content",children:[d,o]}),e[26]=o,e[27]=d,e[28]=j):j=e[28];let k;return e[29]!==u||e[30]!==j?(k=s.jsxs("div",{className:"tool-vector-data-viewer__vector-data",children:[u,j]}),e[29]=u,e[30]=j,e[31]=k):k=e[31],k}const ce=()=>{const t=J.useRef(null),[e,a]=U({fileType:"",active:"1",name:"",fileContent:"",jsonContent:[],textChunks:[],vectors:[]},"dev/vector-data-viewer|processing-data|cache");return{own:e,setOwn:a,uploadBtnRef:t,handleSaveVectorDB:async()=>{const r=await T({method:"post",url:"/vector/save2VectorDB",params:{name:e.name??"tmp",textChunks:e.fileType==="json"?e.jsonContent:e.textChunks||[]}}),{code:n}=r?.data||{};console.log(r?.data),n===200?q.success("Save data to VectorDB Success"):q.error("Save data to VectorDB Error")},handleReadFile:async r=>{const n=r.name.split(".").at(-1),c=await Z(r);if(console.log(c),n==="json")try{const d=JSON.parse(c.trim())||[];a({fileType:n,active:"2",fileContent:c,jsonContent:d,textChunks:d?.map(h=>h.text)})}catch(d){console.error(d),a({fileType:n,active:"1",fileContent:c,textChunks:[]})}else a({fileType:n,active:"1",fileContent:c})},handleGenTextChunk:async()=>{const n=(await T({method:"post",url:"/vector/genTextChunks",params:{value:e.fileContent}}))?.data?.data||[];console.log(n),a({active:"2",textChunks:n})},handleGenTextChunkVector:async()=>{const n=(await T({method:"post",url:"/vector/genTextChunkVectors",params:{name:e.name??"tmp",list:e.fileType==="json"?e.jsonContent:e.textChunks}}))?.data?.data||[];console.log(n),a({active:"3",vectors:n.map(c=>{const{vector:d,...h}=c;return{...h}})||[]})},handleClear:()=>{a({active:"1",name:"",fileContent:"",textChunks:[],vectors:[]})}}};function ie(t){const e=K.c(63),{own:a,setOwn:l,uploadBtnRef:f,handleSaveVectorDB:v,handleReadFile:u,handleGenTextChunk:x,handleGenTextChunkVector:r,handleClear:n}=ce();let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c={display:"none"},e[0]=c):c=e[0];let d;e[1]!==u?(d=$=>{const H=$.target.files?.[0];u(H)},e[1]=u,e[2]=d):d=e[2];let h;e[3]!==d||e[4]!==f?(h=s.jsx("input",{ref:f,type:"file",style:c,onChange:d}),e[3]=d,e[4]=f,e[5]=h):h=e[5];let p;e[6]!==l?(p=$=>{l({name:$.target.value||""})},e[6]=l,e[7]=p):p=e[7];let C;e[8]!==a.name||e[9]!==p?(C=s.jsx(W,{value:a.name,onChange:p}),e[8]=a.name,e[9]=p,e[10]=C):C=e[10];let N;e[11]!==f?(N=s.jsx(g,{onClick:()=>f.current?.click(),children:"Upload File"}),e[11]=f,e[12]=N):N=e[12];const i=!a.fileContent;let m;e[13]!==x?(m=()=>x(),e[13]=x,e[14]=m):m=e[14];let o;e[15]!==i||e[16]!==m?(o=s.jsx(g,{disabled:i,onClick:m,children:"Text Chunk"}),e[15]=i,e[16]=m,e[17]=o):o=e[17];let j;e[18]!==a.textChunks?(j=Y(a.textChunks),e[18]=a.textChunks,e[19]=j):j=e[19];const k=!j;let b;e[20]!==r?(b=()=>r(),e[20]=r,e[21]=b):b=e[21];let y;e[22]!==k||e[23]!==b?(y=s.jsx(g,{disabled:k,onClick:b,children:"Vectorization"}),e[22]=k,e[23]=b,e[24]=y):y=e[24];let _;e[25]!==v?(_=s.jsx(g,{onClick:()=>v(),children:"Save Vector DB"}),e[25]=v,e[26]=_):_=e[26];let w;e[27]!==n?(w=s.jsx(g,{onClick:()=>n(),children:"Clear"}),e[27]=n,e[28]=w):w=e[28];let S;e[29]!==y||e[30]!==_||e[31]!==w||e[32]!==h||e[33]!==C||e[34]!==N||e[35]!==o?(S=s.jsxs("div",{className:"left-aside",children:[h,C,N,o,y,_,w]}),e[29]=y,e[30]=_,e[31]=w,e[32]=h,e[33]=C,e[34]=N,e[35]=o,e[36]=S):S=e[36];let D;e[37]!==l?(D=$=>l({active:$}),e[37]=l,e[38]=D):D=e[38];let V;e[39]!==a.fileContent?(V={key:"1",title:"File Content",children:s.jsx("pre",{children:a.fileContent})},e[39]=a.fileContent,e[40]=V):V=e[40];let B;e[41]!==a.textChunks?(B=a?.textChunks?.map(re),e[41]=a.textChunks,e[42]=B):B=e[42];let R;e[43]!==B?(R={key:"2",title:"Chunks Data",children:s.jsx("div",{className:"chunks-data",children:B})},e[43]=B,e[44]=R):R=e[44];let A,I,P;e[45]===Symbol.for("react.memo_cache_sentinel")?(A=s.jsx("div",{className:"item header id",children:"ID"}),I=s.jsx("div",{className:"item header key",children:"Key"}),P=s.jsx("div",{className:"item header text",children:"Text"}),e[45]=A,e[46]=I,e[47]=P):(A=e[45],I=e[46],P=e[47]);let F;e[48]!==a.vectors?(F=a?.vectors?.map(oe),e[48]=a.vectors,e[49]=F):F=e[49];let E;e[50]!==F?(E={key:"3",title:"Vector Data",children:s.jsxs("div",{className:"vectors-data",children:[A,I,P,F]})},e[50]=F,e[51]=E):E=e[51];let G;e[52]!==V||e[53]!==R||e[54]!==E?(G=[V,R,E],e[52]=V,e[53]=R,e[54]=E,e[55]=G):G=e[55];let O;e[56]!==a.active||e[57]!==D||e[58]!==G?(O=s.jsx("div",{className:"right-aside",children:s.jsx(L,{value:a.active,onChange:D,items:G})}),e[56]=a.active,e[57]=D,e[58]=G,e[59]=O):O=e[59];let z;return e[60]!==S||e[61]!==O?(z=s.jsxs("div",{className:"tool-vector-data-viewer__processing-data",children:[S,O]}),e[60]=S,e[61]=O,e[62]=z):z=e[62],z}function oe(t,e){const{id:a,key:l,text:f}=t;return s.jsxs(J.Fragment,{children:[s.jsx("div",{className:"item id",children:a}),s.jsx("div",{className:"item key",children:l}),s.jsx("div",{className:"item text",children:f})]},e)}function re(t,e){return s.jsx("div",{className:"row",children:t},e)}function Ce(){const t=ee(),{state:e,setState:a}=t,l=[{key:"vector-data",title:"Vector Data",children:s.jsx(ne,{h:t})},{key:"processing-data",title:"Processing Data",children:s.jsx(ie,{h:t})}];return s.jsx("div",{className:"tool-vector-data-viewer",children:s.jsx(L,{value:e.active,items:l,onChange:f=>a({active:f})})})}export{Ce as default};
