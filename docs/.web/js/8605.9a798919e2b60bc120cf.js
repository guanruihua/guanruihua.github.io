"use strict";(self.webpackChunkguanruihua_github_io=self.webpackChunkguanruihua_github_io||[]).push([[8605],{46045(e,t,i){i.d(t,{xI:()=>h});var r=i(65296);function l(e){return null==e||e!=e}function a(e){try{if("object"==typeof(t=e)&&!l(t)&&/Iterator\]$/.test(t.toString()))return"Iterator";const i=Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1];return"Number"===i&&isNaN(e)?"NaN":i}catch(e){return"Undefined"}var t}function n(e){return"string"==typeof e}const s=e=>"number"==typeof e&&"Number"===a(e);function o(e){return!l(e)&&(function(e){return Array.isArray(e)}(e)&&e.length>0)}const d="undefined"!=typeof window;function h(e={},t,i=localStorage){const[l,a]=(0,r.useState)(e),d=e=>{if(a(e),t)try{i.setItem(t,JSON.stringify(e))}catch(e){return void console.warn(e)}};return(0,r.useEffect)(()=>{if(t)try{const e=i.getItem(t);if(!e||"{}"===e)return;d(JSON.parse(e))}catch(e){return}},[t,i]),[l,(e,t=!1)=>{const i="function"==typeof e?e(l):e;d(t?i:{...l,...i})},t=>{if(o(t)){const i={...l};return t.forEach(t=>{(n(t)||s(t))&&(i[t]=e[t])}),void d(i)}d(e)}]}d&&window?.navigator?.userAgent&&/iP(ad|hone|od)/.test(window.navigator.userAgent)},48260(e,t,i){i.r(t),i.d(t,{default:()=>s});var r=i(65296),l=i(46045);const a=i.p+".web/img/tile.png",n=(e,t)=>{if(!e)return;let i={tileSize:200,colors:{0:16777215,2:16777215,4:16772846,8:16768477,16:16764108,32:16759739,64:16755370,128:16751001,256:16746632,512:16742263,1024:16737894,2048:16733525,4096:16729156,8192:16724787,16384:16720418,32768:16716049,65536:16711680},tweenSpeed:50};var r=new e.Class({Extends:e.Scene,initialize:function(){e.Scene.call(this,{key:"PlayGame"})},preload:function(){this.load.image("tile",a)},create:function(){this.fieldArray=[],this.fieldGroup=this.add.group();for(var e=0;e<4;e++){this.fieldArray[e]=[];for(var t=0;t<4;t++){var r=this.add.sprite(t*i.tileSize+i.tileSize/2,e*i.tileSize+i.tileSize/2,"tile");r.alpha=0,r.visible=0,this.fieldGroup.add(r);var l=this.add.text(t*i.tileSize+i.tileSize/2,e*i.tileSize+i.tileSize/2,"2",{font:"bold 64px Arial",color:"black",align:"center"});l.setOrigin(.5),l.alpha=0,l.visible=0,this.fieldGroup.add(l),this.fieldArray[e][t]={tileValue:0,tileSprite:r,tileText:l,canUpgrade:!0}}}console.log(this),this.input.keyboard.on("keydown",this.handleKey,this),this.canMove=!1,this.addTwo(),this.addTwo()},addTwo:function(){for(var t=[],r=0;r<4;r++)for(var l=0;l<4;l++)0==this.fieldArray[r][l].tileValue&&t.push({row:r,col:l});var a=e.Utils.Array.GetRandomElement(t);this.fieldArray[a.row][a.col].tileValue=2,this.fieldArray[a.row][a.col].tileSprite.visible=!0,this.fieldArray[a.row][a.col].tileText.setText("2"),this.fieldArray[a.row][a.col].tileText.visible=!0,this.tweens.add({targets:[this.fieldArray[a.row][a.col].tileSprite,this.fieldArray[a.row][a.col].tileText],alpha:1,duration:i.tweenSpeed,onComplete:function(e){e.parent.scene.canMove=!0}})},handleKey:function(e){if(this.canMove){var t=this.fieldGroup.getChildren();switch(e.code){case"ArrowLeft":case"KeyA":for(var i=0;i<t.length;i++)t[i].depth=t[i].x;this.handleMove(0,-1);break;case"ArrowRight":case"KeyD":for(i=0;i<t.length;i++)t[i].depth=n.config.width-t[i].x;this.handleMove(0,1);break;case"ArrowUp":case"KeyW":for(i=0;i<t.length;i++)t[i].depth=t[i].y;this.handleMove(-1,0);break;case"ArrowDown":case"KeyS":for(i=0;i<t.length;i++)t[i].depth=n.config.height-t[i].y;this.handleMove(1,0)}}},handleMove:function(e,t){this.canMove=!1;var i=!1;this.movingTiles=0;for(var r=0;r<4;r++)for(var l=0;l<4;l++){var a=1==t?3-l:l,n=1==e?3-r:r,s=this.fieldArray[n][a].tileValue;if(0!=s){for(var o=t,d=e;this.isInsideBoard(n+d,a+o)&&0==this.fieldArray[n+d][a+o].tileValue;)o+=t,d+=e;this.isInsideBoard(n+d,a+o)&&this.fieldArray[n+d][a+o].tileValue==s&&this.fieldArray[n+d][a+o].canUpgrade&&this.fieldArray[n][a].canUpgrade?(this.fieldArray[n+d][a+o].tileValue=2*s,this.fieldArray[n+d][a+o].canUpgrade=!1,this.fieldArray[n][a].tileValue=0,this.moveTile(this.fieldArray[n][a],n+d,a+o,Math.abs(d+o),!0),i=!0):(d-=e,0==(o-=t)&&0==d||(this.fieldArray[n+d][a+o].tileValue=s,this.fieldArray[n][a].tileValue=0,this.moveTile(this.fieldArray[n][a],n+d,a+o,Math.abs(d+o),!1),i=!0))}}i||(this.canMove=!0)},moveTile:function(e,t,r,l,a){this.movingTiles++,this.tweens.add({targets:[e.tileSprite,e.tileText],x:r*i.tileSize+i.tileSize/2,y:t*i.tileSize+i.tileSize/2,duration:i.tweenSpeed*l,onComplete:function(i){i.parent.scene.movingTiles--,a&&i.parent.scene.transformTile(e,t,r),0==i.parent.scene.movingTiles&&(i.parent.scene.resetTiles(),i.parent.scene.addTwo())}})},transformTile:function(e,t,r){this.movingTiles++,e.tileText.setText(this.fieldArray[t][r].tileValue.toString()),e.tileSprite.setTint(i.colors[this.fieldArray[t][r].tileValue]),this.tweens.add({targets:[e.tileSprite],scaleX:1.1,scaleY:1.1,duration:i.tweenSpeed,yoyo:!0,repeat:1,onComplete:function(e){e.parent.scene.movingTiles--,0==e.parent.scene.movingTiles&&(e.parent.scene.resetTiles(),e.parent.scene.addTwo())}})},resetTiles:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.fieldArray[e][t].canUpgrade=!0,this.fieldArray[e][t].tileSprite.x=t*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileSprite.y=e*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileText.x=t*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileText.y=e*i.tileSize+i.tileSize/2,this.fieldArray[e][t].tileValue>0?(this.fieldArray[e][t].tileSprite.alpha=1,this.fieldArray[e][t].tileSprite.visible=!0,this.fieldArray[e][t].tileText.alpha=1,this.fieldArray[e][t].tileText.visible=!0,this.fieldArray[e][t].tileText.setText(this.fieldArray[e][t].tileValue.toString())):(this.fieldArray[e][t].tileValue=0,this.fieldArray[e][t].tileSprite.alpha=0,this.fieldArray[e][t].tileSprite.visible=!1,this.fieldArray[e][t].tileText.alpha=0,this.fieldArray[e][t].tileText.visible=!1),this.fieldArray[e][t].tileSprite.setTint(i.colors[this.fieldArray[e][t].tileValue])},isInsideBoard:function(e,t){return e>=0&&t>=0&&e<4&&t<4}}),l={type:e.WEBGL,width:4*i.tileSize,height:4*i.tileSize,backgroundColor:4473924,parent:t,scene:[r]};let n=new e.Game(l);function s(){var e=document.querySelector("canvas");if(e){var t=window.innerWidth,i=window.innerHeight,r=t/i,l=n.config.width/n.config.height;r<l?(e.style.width=t+"px",e.style.height=t/l+"px"):(e.style.width=i*l+"px",e.style.height=i+"px")}}window.focus(),s(),window.addEventListener("resize",s,!1)};function s(){const{ref:e,state:t,setState:i}=(()=>{const[e,t]=(0,l.xI)({}),i=r.useRef(null);return r.useEffect(()=>{if(!i.current)return;const e="/js/phaser.min.js",t=document.createElement("script");return t.src=e,t.onload=()=>{console.log(e,"已加载");const t=window.Phaser;t&&n(t,i.current)},document.body.appendChild(t),()=>{document.body.removeChild(t)}},[i.current]),{ref:i,state:e,setState:t}})();return r.createElement("div",{className:"game__2048"},r.createElement("div",{ref:e}))}}}]);