import{R as p,v as w,j as n,g as j}from"./index-O7V8KczI.js";import{g as C}from"./index.esm-vp3mBawv.js";import{i as I}from"./index.esm-B6V8xwJH.js";function k(c,l,a=1){return new Promise(u=>{const h=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;let d;const e=h.open(c,a);e.onsuccess=function(s){d=s.target.result,u(d)},e.onerror=function(s){console.log("数据库打开失败")},e.onupgradeneeded=function(s){d=s.target.result;var o;o=d.createObjectStore(l,{keyPath:"key"}),o.createIndex("key","key",{unique:!0}),o.createIndex("value","value",{unique:!1}),o.createIndex("name","name",{unique:!1}),o.createIndex("sort","sort",{unique:!1}),o.createIndex("info","info",{unique:!1})}})}const S=()=>{let c=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){const u=(c+Math.random()*16)%16|0;return c=Math.floor(c/16),(a=="x"?u:u&3|8).toString(16)})},z=c=>{const{dbName:l="CacheDB",tableName:a="store",callback:u={}}=c||{},h=p.useRef(null),d=async()=>{try{const e=await k(l,a);e&&(h.current=e,u?.afterInitSuccess?.(e))}catch(e){console.error(e)}};return p.useEffect(()=>{d()},[]),{ref:h,getStore(){return h.current?h.current?.transaction?.([a],"readwrite").objectStore(a):null},getKey(){return S()},async getAll(){return new Promise(e=>{try{const s=[],o=this.getStore()?.openCursor();o&&(o.onsuccess=function(f){const x=f.target.result;x?(s.push(x.value),x.continue()):e(s.sort((m,i)=>{const t=m?.sort||1,r=i?.sort||1;return t-r}))})}catch{e([])}})},async get(e){return new Promise(s=>{const o=this.getStore().get(e)||null;o?(o.onsuccess=function(f){s(f.target.result)},o.onerror=function(f){s(null)}):s(null)})},del(e){this.getStore()?.delete(e)},add(e){return e.key||(e.key=this.getKey()),e.info||(e.info={}),e.sort||(e.sort=new Date().getTime()),this.getStore()?.add(e),e},update(e){return this.getStore()?.put(e),e}}},B=c=>c.match(/^data:(.*?);base64,/)?.[1]||"";async function D(c){try{const l="image/png",a=c.split(",")[1],u=atob(a),h=[];for(let s=0;s<u.length;s+=512){const o=u.slice(s,s+512),f=new Array(o.length);for(let m=0;m<o.length;m++)f[m]=o.charCodeAt(m);const x=new Uint8Array(f);h.push(x)}const d=new Blob(h,{type:l}),e=new ClipboardItem({[l]:d});await navigator.clipboard.write([e]),w.success("Copy Image Success"),console.log("图片已复制到剪贴板！")}catch(l){w.error("Copy Image Error"),console.error("复制失败:",l)}}function M(c,l="image.png"){const a=document.createElement("a");a.href=c,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a)}const y={view:n.jsx("svg",{viewBox:"64 64 896 896",focusable:"false","data-icon":"eye",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:n.jsx("path",{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"})}),download:n.jsx("svg",{viewBox:"64 64 896 896",focusable:"false","data-icon":"download",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:n.jsx("path",{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"})}),copy:n.jsx("svg",{viewBox:"64 64 896 896",focusable:"false","data-icon":"copy",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:n.jsx("path",{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"})}),del:n.jsx("svg",{viewBox:"64 64 896 896",focusable:"false","data-icon":"delete",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:n.jsx("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})})};function E(){const c=p.useRef(null),l=p.useRef(null),[a,u]=p.useState(""),[h,d]=p.useState([]),e=z({callback:{afterInitSuccess(){e.getAll().then(d)}}}),s=async i=>{const t=await e.get(i)||{},{value:r,name:g}=t;r&&M(r,g)},o=async i=>new Promise(t=>{const r=new FileReader;r.readAsDataURL(i),r.onload=function(){if(r.result){const g=e.add({name:i.name,value:r.result});t(g)}else t(null)}}),f=async i=>{const t=(await e.get(i))?.value||"";!t||!I(t)||D(t)},x=async(i=[])=>{const t=[];for(let r=0;r<i.length;r++){const g=i[r],v=await o(g);v&&t.push(v)}return d(r=>[...r,...t]),!0};function m(i){try{const t=Array.from(i.clipboardData?.items).map(r=>{if(r.type.includes("image"))return r?.getAsFile()}).filter(Boolean);x(t).then(r=>{r?w.success("Paste Image Success"):w.error("Paste Image Error")})}catch(t){console.error(t)}}return p.useEffect(()=>{if(c.current)return c.current.removeEventListener("paste",m),c.current.addEventListener("paste",m),()=>{c.current?.removeEventListener("paste",m)}},[c.current]),n.jsx("div",{children:n.jsxs("div",{className:"image-preview",children:[h.map(i=>{const{key:t,value:r}=i,g=B(r);return n.jsxs("div",{className:"image-preview-item",children:[n.jsx("div",{className:C("image-preview-item-img",{view:t===a}),onClick:()=>t===a&&u(""),children:n.jsx("img",{src:r})}),n.jsxs("div",{className:"control",children:[n.jsx("div",{onClick:()=>u(t),children:y.view}),n.jsx("div",{onClick:async()=>s(t),children:y.download}),n.jsx(j,{none:!["image/png","image/jpeg"].includes(g),onClick:()=>f(t),children:y.copy}),n.jsx("div",{className:"del",onClick:()=>{d(v=>v.filter(b=>b.key!==t)),e.del(t)},children:y.del})]})]},t)}),n.jsxs("div",{className:"upload",onMouseEnter:()=>{c.current?.click()},onClick:()=>{l.current?.click()},children:[n.jsx("span",{children:"Add"}),n.jsx("input",{ref:l,type:"file",multiple:!0,style:{display:"none"},onChange:i=>{const t=i.target.files||[];x(t)}})]},"upload"),n.jsxs("div",{className:"paste-upload-box",children:[n.jsx("span",{className:"text",children:"Paste"}),n.jsx("input",{className:"paste-upload",ref:c})]})]})})}export{E as default};
